species_name = c()
for (i in 1:length(labels)) {
for (j in 1:length(asv_tax$label)) {
if (labels[i] == asv_tax$label[j]) {
species_name <- c(species_name, asv_tax$Species.name[j])
}
}
}
d <- data.frame(label=tree$tip.label, species=species_name)
p <- ggtree(tree, layout="fan", open.angle=90)
offset = 0
for (n in 1:length(colnames(ASV))) {
name = colnames(ASV)[n]
this_df = ASV[, name]
cols = colors[[name]]
cols = strsplit(cols, ", ")
p <- p + new_scale_fill()
p <- gheatmap(p, this_df, offset=offset, width=.15, colnames_angle=90, font.size=2, hjust=1, color="black") + scale_fill_gradient2(low=cols[[1]][1], mid="white", high=cols[[1]][2])
offset = offset+0.4
}
offset = offset+0.5
p <- p %<+% d + geom_tiplab(aes(label=species), parse=F, size=2, align=T, linesize=.12, offset=offset)
p <- p + theme(legend.position="none")
pdf(py$save_name)
p
#dev.off()
}
#r_ancom_tree('/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/ancom/marine_phylum_ancom_significant.csv', '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/agglom/reduced_tree.tree', "/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/taxonomy_name_only.csv", '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/figures/ancom/marine_ancom_significance_phylum.pdf')
#load_all_R_packages()
r_ancom_tree <- function() {
ft_fn = '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/ancom/marine_phylum_ancom_significant.csv'
tree_fn = '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/agglom/reduced_tree.tree'
tax_fn = "/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/taxonomy_name_only.csv"
save_name = '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/figures/ancom/marine_ancom_significance_phylum.pdf'
asv_table <- read.csv(ft_fn, sep=",", row.names=1, check.names=FALSE)
asv_table = as.matrix(asv_table)
colors = asv_table['Colors', ]
asv_table <- asv_table[!rownames(asv_table) %in% c('Colors'), ]
class(asv_table) <- "numeric"
phy_tree <- read_tree(tree_fn)
taxonomy <- read.csv(tax_fn, sep=",", row.names=1)
taxonomy = as.matrix(taxonomy)
asv_df = as.data.frame(asv_table)
tax_df = as.data.frame(taxonomy, stringsAsFactors=F)
ASV = otu_table(asv_table, taxa_are_rows = TRUE)
physeq = phyloseq(ASV,phy_tree)
tree = phy_tree(physeq)
detach("package:microbiome", unload=TRUE)
detach("package:phyloseq", unload=TRUE)
library("ggplot2")
library("ape")
library("ggtree")
asv_tax_full <- merge(asv_df, tax_df, by="row.names")
asv_tax <- asv_tax_full[,c("Row.names", "Species.name")]
colnames(asv_tax) <- c("label", "Species.name")
labels = tree$tip.label
species_name = c()
for (i in 1:length(labels)) {
for (j in 1:length(asv_tax$label)) {
if (labels[i] == asv_tax$label[j]) {
species_name <- c(species_name, asv_tax$Species.name[j])
}
}
}
d <- data.frame(label=tree$tip.label, species=species_name)
p <- ggtree(tree, layout="fan", open.angle=90)
offset = 0
for (n in 1:length(colnames(ASV))) {
name = colnames(ASV)[n]
this_df = ASV[, name]
cols = colors[[name]]
cols = strsplit(cols, ", ")
p <- p + new_scale_fill()
p <- gheatmap(p, this_df, offset=offset, width=.15, colnames_angle=90, font.size=2, hjust=1, color="black") + scale_fill_gradient2(low=cols[[1]][1], mid="white", high=cols[[1]][2])
offset = offset+0.4
}
offset = offset+0.5
p <- p %<+% d + geom_tiplab(aes(label=species), parse=F, size=2, align=T, linesize=.12, offset=offset)
p <- p + theme(legend.position="none")
pdf(save_name)
p
#dev.off()
}
load_all_R_packages()
r_ancom_tree()
load_all_R_packages()
#r_ancom_tree('/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/ancom/marine_phylum_ancom_significant.csv', '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/agglom/reduced_tree.tree', "/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/taxonomy_name_only.csv", '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/figures/ancom/marine_ancom_significance_phylum.pdf')
#load_all_R_packages()
r_ancom_tree <- function() {
ft_fn = paste(py$basedir, 'ancom_significant.csv', sep='')
tree_fn = paste(py$basedir, 'agglom/reduced_tree.tree', sep='')
tax_fn = paste(py$basedir, 'taxonomy_name_only.csv', sep='')
save_name = paste(py$basedir, 'ancom_heatmap.pdf', sep='')
asv_table <- read.csv(ft_fn, sep=",", row.names=1, check.names=FALSE)
asv_table = as.matrix(asv_table)
colors = asv_table['Colors', ]
asv_table <- asv_table[!rownames(asv_table) %in% c('Colors'), ]
class(asv_table) <- "numeric"
phy_tree <- read_tree(tree_fn)
taxonomy <- read.csv(tax_fn, sep=",", row.names=1)
taxonomy = as.matrix(taxonomy)
asv_df = as.data.frame(asv_table)
tax_df = as.data.frame(taxonomy, stringsAsFactors=F)
ASV = otu_table(asv_table, taxa_are_rows = TRUE)
physeq = phyloseq(ASV,phy_tree)
tree = phy_tree(physeq)
detach("package:microbiome", unload=TRUE)
detach("package:phyloseq", unload=TRUE)
library("ggplot2")
library("ape")
library("ggtree")
asv_tax_full <- merge(asv_df, tax_df, by="row.names")
asv_tax <- asv_tax_full[,c("Row.names", "Species.name")]
colnames(asv_tax) <- c("label", "Species.name")
labels = tree$tip.label
species_name = c()
for (i in 1:length(labels)) {
for (j in 1:length(asv_tax$label)) {
if (labels[i] == asv_tax$label[j]) {
species_name <- c(species_name, asv_tax$Species.name[j])
}
}
}
d <- data.frame(label=tree$tip.label, species=species_name)
p <- ggtree(tree, layout="fan", open.angle=90)
offset = 0
for (n in 1:length(colnames(ASV))) {
name = colnames(ASV)[n]
this_df = ASV[, name]
cols = colors[[name]]
cols = strsplit(cols, ", ")
p <- p + new_scale_fill()
p <- gheatmap(p, this_df, offset=offset, width=.15, colnames_angle=90, font.size=2, hjust=1, color="black") + scale_fill_gradient2(low=cols[[1]][1], mid="white", high=cols[[1]][2])
offset = offset+0.4
}
offset = offset+0.5
p <- p %<+% d + geom_tiplab(aes(label=species), parse=F, size=2, align=T, linesize=.12, offset=offset)
p <- p + theme(legend.position="none")
pdf(save_name)
p
#dev.off()
}
load_all_R_packages()
r_ancom_tree()
load_all_R_packages()
#r_ancom_tree('/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/ancom/marine_phylum_ancom_significant.csv', '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/agglom/reduced_tree.tree', "/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/taxonomy_name_only.csv", '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/figures/ancom/marine_ancom_significance_phylum.pdf')
#load_all_R_packages()
r_ancom_tree <- function() {
load_all_R_packages()
ft_fn = paste(py$basedir, 'ancom_significant.csv', sep='')
tree_fn = paste(py$basedir, 'agglom/reduced_tree.tree', sep='')
tax_fn = paste(py$basedir, 'taxonomy_name_only.csv', sep='')
save_name = paste(py$basedir, 'ancom_heatmap.pdf', sep='')
asv_table <- read.csv(ft_fn, sep=",", row.names=1, check.names=FALSE)
asv_table = as.matrix(asv_table)
colors = asv_table['Colors', ]
asv_table <- asv_table[!rownames(asv_table) %in% c('Colors'), ]
class(asv_table) <- "numeric"
phy_tree <- read_tree(tree_fn)
taxonomy <- read.csv(tax_fn, sep=",", row.names=1)
taxonomy = as.matrix(taxonomy)
asv_df = as.data.frame(asv_table)
tax_df = as.data.frame(taxonomy, stringsAsFactors=F)
ASV = otu_table(asv_table, taxa_are_rows = TRUE)
physeq = phyloseq(ASV,phy_tree)
tree = phy_tree(physeq)
detach("package:microbiome", unload=TRUE)
detach("package:phyloseq", unload=TRUE)
library("ggplot2")
library("ape")
library("ggtree")
asv_tax_full <- merge(asv_df, tax_df, by="row.names")
asv_tax <- asv_tax_full[,c("Row.names", "Species.name")]
colnames(asv_tax) <- c("label", "Species.name")
labels = tree$tip.label
species_name = c()
for (i in 1:length(labels)) {
for (j in 1:length(asv_tax$label)) {
if (labels[i] == asv_tax$label[j]) {
species_name <- c(species_name, asv_tax$Species.name[j])
}
}
}
d <- data.frame(label=tree$tip.label, species=species_name)
p <- ggtree(tree, layout="fan", open.angle=90)
offset = 0
for (n in 1:length(colnames(ASV))) {
name = colnames(ASV)[n]
this_df = ASV[, name]
cols = colors[[name]]
cols = strsplit(cols, ", ")
p <- p + new_scale_fill()
p <- gheatmap(p, this_df, offset=offset, width=.15, colnames_angle=90, font.size=2, hjust=1, color="black") + scale_fill_gradient2(low=cols[[1]][1], mid="white", high=cols[[1]][2])
offset = offset+0.4
}
offset = offset+0.5
p <- p %<+% d + geom_tiplab(aes(label=species), parse=F, size=2, align=T, linesize=.12, offset=offset)
p <- p + theme(legend.position="none")
pdf(save_name)
p
#dev.off()
load_all_R_packages()
}
#load_all_R_packages()
#r_ancom_tree()
#load_all_R_packages()
#r_ancom_tree('/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/ancom/marine_phylum_ancom_significant.csv', '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/agglom/reduced_tree.tree', "/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/taxonomy_name_only.csv", '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/figures/ancom/marine_ancom_significance_phylum.pdf')
#load_all_R_packages()
r_ancom_tree <- function() {
load_all_R_packages()
ft_fn = paste(py$basedir, 'ancom_significant.csv', sep='')
tree_fn = paste(py$basedir, 'agglom/reduced_tree.tree', sep='')
tax_fn = paste(py$basedir, 'taxonomy_name_only.csv', sep='')
save_name = paste(py$basedir, 'ancom_heatmap.pdf', sep='')
asv_table <- read.csv(ft_fn, sep=",", row.names=1, check.names=FALSE)
asv_table = as.matrix(asv_table)
colors = asv_table['Colors', ]
asv_table <- asv_table[!rownames(asv_table) %in% c('Colors'), ]
class(asv_table) <- "numeric"
phy_tree <- read_tree(tree_fn)
taxonomy <- read.csv(tax_fn, sep=",", row.names=1)
taxonomy = as.matrix(taxonomy)
asv_df = as.data.frame(asv_table)
tax_df = as.data.frame(taxonomy, stringsAsFactors=F)
ASV = otu_table(asv_table, taxa_are_rows = TRUE)
physeq = phyloseq(ASV,phy_tree)
tree = phy_tree(physeq)
detach("package:microbiome", unload=TRUE)
detach("package:phyloseq", unload=TRUE)
library("ggplot2")
library("ape")
library("ggtree")
asv_tax_full <- merge(asv_df, tax_df, by="row.names")
asv_tax <- asv_tax_full[,c("Row.names", "Species.name")]
colnames(asv_tax) <- c("label", "Species.name")
labels = tree$tip.label
species_name = c()
for (i in 1:length(labels)) {
for (j in 1:length(asv_tax$label)) {
if (labels[i] == asv_tax$label[j]) {
species_name <- c(species_name, asv_tax$Species.name[j])
}
}
}
d <- data.frame(label=tree$tip.label, species=species_name)
p <- ggtree(tree, layout="fan", open.angle=90)
offset = 0
for (n in 1:length(colnames(ASV))) {
name = colnames(ASV)[n]
this_df = ASV[, name]
cols = colors[[name]]
cols = strsplit(cols, ", ")
p <- p + new_scale_fill()
p <- gheatmap(p, this_df, offset=offset, width=.15, colnames_angle=90, font.size=2, hjust=1, color="black") + scale_fill_gradient2(low=cols[[1]][1], mid="white", high=cols[[1]][2])
offset = offset+0.4
}
offset = offset+0.5
p <- p %<+% d + geom_tiplab(aes(label=species), parse=F, size=2, align=T, linesize=.12, offset=offset)
p <- p + theme(legend.position="none")
pdf(save_name)
p
#dev.off()
load_all_R_packages()
}
#load_all_R_packages()
r_ancom_tree()
#load_all_R_packages()
#r_ancom_tree('/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/ancom/marine_phylum_ancom_significant.csv', '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/agglom/reduced_tree.tree', "/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/taxonomy_name_only.csv", '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/figures/ancom/marine_ancom_significance_phylum.pdf')
#load_all_R_packages()
r_ancom_tree <- function() {
load_all_R_packages()
ft_fn = paste(py$basedir, 'ancom_significant.csv', sep='')
tree_fn = paste(py$basedir, 'agglom/reduced_tree.tree', sep='')
tax_fn = paste(py$basedir, 'taxonomy_name_only.csv', sep='')
save_name = paste(py$basedir, 'ancom_heatmap.pdf', sep='')
asv_table <- read.csv(ft_fn, sep=",", row.names=1, check.names=FALSE)
asv_table = as.matrix(asv_table)
colors = asv_table['Colors', ]
asv_table <- asv_table[!rownames(asv_table) %in% c('Colors'), ]
class(asv_table) <- "numeric"
phy_tree <- read_tree(tree_fn)
taxonomy <- read.csv(tax_fn, sep=",", row.names=1)
taxonomy = as.matrix(taxonomy)
asv_df = as.data.frame(asv_table)
tax_df = as.data.frame(taxonomy, stringsAsFactors=F)
ASV = otu_table(asv_table, taxa_are_rows = TRUE)
physeq = phyloseq(ASV,phy_tree)
tree = phy_tree(physeq)
detach("package:microbiome", unload=TRUE)
detach("package:phyloseq", unload=TRUE)
library("ggplot2")
library("ape")
library("ggtree")
asv_tax_full <- merge(asv_df, tax_df, by="row.names")
asv_tax <- asv_tax_full[,c("Row.names", "Species.name")]
colnames(asv_tax) <- c("label", "Species.name")
labels = tree$tip.label
species_name = c()
for (i in 1:length(labels)) {
for (j in 1:length(asv_tax$label)) {
if (labels[i] == asv_tax$label[j]) {
species_name <- c(species_name, asv_tax$Species.name[j])
}
}
}
d <- data.frame(label=tree$tip.label, species=species_name)
p <- ggtree(tree, layout="fan", open.angle=90)
offset = 0
for (n in 1:length(colnames(ASV))) {
name = colnames(ASV)[n]
this_df = ASV[, name]
cols = colors[[name]]
cols = strsplit(cols, ", ")
p <- p + new_scale_fill()
p <- gheatmap(p, this_df, offset=offset, width=.15, colnames_angle=90, font.size=2, hjust=1, color="black") + scale_fill_gradient2(low=cols[[1]][1], mid="white", high=cols[[1]][2])
offset = offset+0.4
}
offset = offset+0.5
p <- p %<+% d + geom_tiplab(aes(label=species), parse=F, size=2, align=T, linesize=.12, offset=offset)
p <- p + theme(legend.position="none")
pdf(save_name)
p
#dev.off()
}
#load_all_R_packages()
r_ancom_tree()
#load_all_R_packages()
#r_ancom_tree('/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/ancom/marine_phylum_ancom_significant.csv', '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/agglom/reduced_tree.tree', "/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/taxonomy_name_only.csv", '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/figures/ancom/marine_ancom_significance_phylum.pdf')
#load_all_R_packages()
load_all_R_packages <- function() {
library(reticulate)
library(kableExtra)
library(knitr)
library(exactRankTests)
library(nlme)
library(dplyr)
library(ggplot2)
library(vegan)
library(phyloseq)
library(ape)
library(microbiome)
library(ggnewscale)
library(compositions)
library(ggtree)
}
load_all_R_packages()
r_ancom_tree <- function() {
#load_all_R_packages()
ft_fn = paste(py$basedir, 'ancom_significant.csv', sep='')
tree_fn = paste(py$basedir, 'agglom/reduced_tree.tree', sep='')
tax_fn = paste(py$basedir, 'taxonomy_name_only.csv', sep='')
save_name = paste(py$basedir, 'ancom_heatmap.pdf', sep='')
asv_table <- read.csv(ft_fn, sep=",", row.names=1, check.names=FALSE)
asv_table = as.matrix(asv_table)
colors = asv_table['Colors', ]
asv_table <- asv_table[!rownames(asv_table) %in% c('Colors'), ]
class(asv_table) <- "numeric"
phy_tree <- read_tree(tree_fn)
taxonomy <- read.csv(tax_fn, sep=",", row.names=1)
taxonomy = as.matrix(taxonomy)
asv_df = as.data.frame(asv_table)
tax_df = as.data.frame(taxonomy, stringsAsFactors=F)
ASV = otu_table(asv_table, taxa_are_rows = TRUE)
physeq = phyloseq(ASV,phy_tree)
tree = phy_tree(physeq)
asv_tax_full <- merge(asv_df, tax_df, by="row.names")
asv_tax <- asv_tax_full[,c("Row.names", "Species.name")]
colnames(asv_tax) <- c("label", "Species.name")
labels = tree$tip.label
species_name = c()
for (i in 1:length(labels)) {
for (j in 1:length(asv_tax$label)) {
if (labels[i] == asv_tax$label[j]) {
species_name <- c(species_name, asv_tax$Species.name[j])
}
}
}
d <- data.frame(label=tree$tip.label, species=species_name)
p <- ggtree(tree, layout="fan", open.angle=90)
offset = 0
for (n in 1:length(colnames(ASV))) {
name = colnames(ASV)[n]
this_df = ASV[, name]
cols = colors[[name]]
cols = strsplit(cols, ", ")
p <- p + new_scale_fill()
p <- gheatmap(p, this_df, offset=offset, width=.15, colnames_angle=90, font.size=2, hjust=1, color="black") + scale_fill_gradient2(low=cols[[1]][1], mid="white", high=cols[[1]][2])
offset = offset+0.4
}
offset = offset+0.5
p <- p %<+% d + geom_tiplab(aes(label=species), parse=F, size=2, align=T, linesize=.12, offset=offset)
p <- p + theme(legend.position="none")
pdf(save_name)
p
#dev.off()
}
#load_all_R_packages()
r_ancom_tree()
#load_all_R_packages()
#r_ancom_tree('/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/ancom/marine_phylum_ancom_significant.csv', '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/agglom/reduced_tree.tree', "/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/taxonomy_name_only.csv", '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/figures/ancom/marine_ancom_significance_phylum.pdf')
#load_all_R_packages()
r_ancom_tree <- function() {
#load_all_R_packages()
ft_fn = paste(py$basedir, 'ancom_significant.csv', sep='')
tree_fn = paste(py$basedir, 'agglom/reduced_tree.tree', sep='')
tax_fn = paste(py$basedir, 'taxonomy_name_only.csv', sep='')
save_name = paste(py$basedir, 'ancom_heatmap.pdf', sep='')
asv_table <- read.csv(ft_fn, sep=",", row.names=1, check.names=FALSE)
asv_table = as.matrix(asv_table)
colors = asv_table['Colors', ]
asv_table <- asv_table[!rownames(asv_table) %in% c('Colors'), ]
class(asv_table) <- "numeric"
phy_tree <- read_tree(tree_fn)
taxonomy <- read.csv(tax_fn, sep=",", row.names=1)
taxonomy = as.matrix(taxonomy)
asv_df = as.data.frame(asv_table)
tax_df = as.data.frame(taxonomy, stringsAsFactors=F)
ASV = otu_table(asv_table, taxa_are_rows = TRUE)
physeq = phyloseq(ASV,phy_tree)
tree = phy_tree(physeq)
asv_tax_full <- merge(asv_df, tax_df, by="row.names")
asv_tax <- asv_tax_full[,c("Row.names", "Species.name")]
colnames(asv_tax) <- c("label", "Species.name")
labels = tree$tip.label
species_name = c()
for (i in 1:length(labels)) {
for (j in 1:length(asv_tax$label)) {
if (labels[i] == asv_tax$label[j]) {
species_name <- c(species_name, asv_tax$Species.name[j])
}
}
}
d <- data.frame(label=tree$tip.label, species=species_name)
p <- ggtree(tree, layout="fan", open.angle=90)
offset = 0
for (n in 1:length(colnames(ASV))) {
name = colnames(ASV)[n]
this_df = ASV[, name]
cols = colors[[name]]
cols = strsplit(cols, ", ")
p <- p + new_scale_fill()
p <- gheatmap(p, this_df, offset=offset, width=.15, colnames_angle=90, font.size=2, hjust=1, color="black") + scale_fill_gradient2(low=cols[[1]][1], mid="white", high=cols[[1]][2])
offset = offset+0.4
}
offset = offset+0.5
p <- p %<+% d + geom_tiplab(aes(label=species), parse=F, size=2, align=T, linesize=.12, offset=offset)
p <- p + theme(legend.position="none")
pdf(save_name)
p
#dev.off()
}
#load_all_R_packages()
r_ancom_tree()
#load_all_R_packages()
#r_ancom_tree('/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/ancom/marine_phylum_ancom_significant.csv', '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/agglom/reduced_tree.tree', "/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/taxonomy_name_only.csv", '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/figures/ancom/marine_ancom_significance_phylum.pdf')
#load_all_R_packages()
r_ancom_tree <- function(lr) {
#load_all_R_packages()
ft_fn = paste(py$basedir, 'ancom_significant.csv', sep='')
tree_fn = paste(py$basedir, 'agglom/reduced_tree.tree', sep='')
tax_fn = paste(py$basedir, 'taxonomy_name_only.csv', sep='')
save_name = paste(py$basedir, 'ancom_heatmap.pdf', sep='')
asv_table <- read.csv(ft_fn, sep=",", row.names=1, check.names=FALSE)
asv_table = as.matrix(asv_table)
colors = asv_table['Colors', ]
asv_table <- asv_table[!rownames(asv_table) %in% c('Colors'), ]
class(asv_table) <- "numeric"
phy_tree <- read_tree(tree_fn)
taxonomy <- read.csv(tax_fn, sep=",", row.names=1)
taxonomy = as.matrix(taxonomy)
asv_df = as.data.frame(asv_table)
tax_df = as.data.frame(taxonomy, stringsAsFactors=F)
ASV = otu_table(asv_table, taxa_are_rows = TRUE)
physeq = phyloseq(ASV,phy_tree)
tree = phy_tree(physeq)
asv_tax_full <- merge(asv_df, tax_df, by="row.names")
asv_tax <- asv_tax_full[,c("Row.names", "Species.name")]
colnames(asv_tax) <- c("label", "Species.name")
labels = tree$tip.label
species_name = c()
for (i in 1:length(labels)) {
for (j in 1:length(asv_tax$label)) {
if (labels[i] == asv_tax$label[j]) {
species_name <- c(species_name, asv_tax$Species.name[j])
}
}
}
d <- data.frame(label=tree$tip.label, species=species_name)
p <- ggtree(tree, layout="fan", open.angle=90)
offset = 0
for (n in 1:length(colnames(ASV))) {
name = colnames(ASV)[n]
this_df = ASV[, name]
cols = colors[[name]]
cols = strsplit(cols, ", ")
p <- p + new_scale_fill()
p <- gheatmap(p, this_df, offset=offset, width=.15, colnames_angle=90, font.size=2, hjust=1, color="black") + scale_fill_gradient2(low=cols[[1]][1], mid="white", high=cols[[1]][2])
offset = offset+0.4
}
offset = offset+0.5
p <- p %<+% d + geom_tiplab(aes(label=species), parse=F, size=2, align=T, linesize=.12, offset=offset)
p <- p + theme(legend.position="none")
pdf(save_name)
p
#dev.off()
}
#load_all_R_packages()
r_ancom_tree()
#load_all_R_packages()
#r_ancom_tree('/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/ancom/marine_phylum_ancom_significant.csv', '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/agglom/reduced_tree.tree', "/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/taxonomy_name_only.csv", '/Users/robynwright/Documents/OneDrive/Papers_writing/Plastisphere_Meta-analysis/test_recreate_analyses/recreate_analyses/figures/ancom/marine_ancom_significance_phylum.pdf')
#load_all_R_packages()
taxonomy <- read.csv(tax_fn, sep=",", row.names=1)
